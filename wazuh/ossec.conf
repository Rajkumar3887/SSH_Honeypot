<!--
  Wazuh Agent Configuration for SSH Honeypot
  ============================================
  Deploy this on the same host as the honeypot (or on a Wazuh agent
  that has read access to the honeypot's logs/ directory).

  Replace WAZUH_MANAGER_IP with your actual Wazuh manager address.
-->
<ossec_config>

  <!-- ── Agent registration ─────────────────────────────────────────────── -->
  <client>
    <server>
      <address>WAZUH_MANAGER_IP</address>
      <port>1514</port>
      <protocol>tcp</protocol>
    </server>
    <config-profile>ubuntu, ubuntu20</config-profile>
    <notify_time>10</notify_time>
    <time-reconnect>60</time-reconnect>
    <auto_restart>yes</auto_restart>
  </client>

  <!-- ── Log collection – honeypot JSON logs ────────────────────────────── -->

  <!-- Connection & authentication events -->
  <localfile>
    <log_format>json</log_format>
    <location>/opt/honeypot/logs/funnel.log</location>
    <label key="log_type">honeypot_funnel</label>
  </localfile>

  <!-- Command audit log -->
  <localfile>
    <log_format>json</log_format>
    <location>/opt/honeypot/logs/cmd_audits.log</location>
    <label key="log_type">honeypot_commands</label>
  </localfile>

  <!-- Threat detection alerts -->
  <localfile>
    <log_format>json</log_format>
    <location>/opt/honeypot/logs/threats.log</location>
    <label key="log_type">honeypot_threats</label>
  </localfile>

  <!-- System / operator log -->
  <localfile>
    <log_format>json</log_format>
    <location>/opt/honeypot/logs/system.log</location>
    <label key="log_type">honeypot_system</label>
  </localfile>

  <!-- ── Syscheck – detect changes to honeypot files ───────────────────── -->
  <syscheck>
    <frequency>3600</frequency>
    <alert_new_files>yes</alert_new_files>
    <directories check_all="yes" realtime="yes">/opt/honeypot/logs</directories>
    <!-- Ignore rotated log backups -->
    <ignore>/opt/honeypot/logs/*.log.*</ignore>
  </syscheck>

  <!-- ── Rootcheck ──────────────────────────────────────────────────────── -->
  <rootcheck>
    <disabled>no</disabled>
    <frequency>43200</frequency>
  </rootcheck>

  <!-- ── Active Response (optional) ────────────────────────────────────── -->
  <!--
    Uncomment to automatically block IPs that trigger high-severity rules.
    Requires iptables on the honeypot host.

  <active-response>
    <disabled>no</disabled>
    <ca_store>etc/wpk_root.pem</ca_store>
    <ca_verification>yes</ca_verification>
  </active-response>
  -->

</ossec_config>
